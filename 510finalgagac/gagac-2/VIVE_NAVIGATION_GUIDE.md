# VIVEå®šä½å¯¼èˆªå®Œæ•´æ–¹æ³•æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜ä»**è·å–Viveä½ç½®** â†’ **è®¡ç®—ç›®æ ‡è·¯å¾„** â†’ **æ‰§è¡Œæ§åˆ¶å‘½ä»¤** â†’ **ç§»åŠ¨åˆ°ç›®æ ‡ä½ç½®**çš„å®Œæ•´æµç¨‹å’Œæ–¹æ³•ã€‚

---

## ğŸ”„ å®Œæ•´å·¥ä½œæµç¨‹

### æµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. Viveä½ç½®è·å–é˜¶æ®µ                                        â”‚
â”‚     - ä¸¤ä¸ªtrackeræ¥æ”¶åŸºç«™ä¿¡å·                               â”‚
â”‚     - è®¡ç®—ä¸­å¿ƒä½ç½® (X, Y)                                   â”‚
â”‚     - è®¡ç®—æœå‘è§’åº¦ (Angle)                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. æ•°æ®ä¼ è¾“é˜¶æ®µ                                            â”‚
â”‚     Servantæ¿ â†’ Owneræ¿ (UART)                              â”‚
â”‚     æ ¼å¼: "VIVE:x.xx,y.yy,a.aa\n"                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. å¯¼èˆªè®¡ç®—é˜¶æ®µ (Owneræ¿)                                  â”‚
â”‚     - è§£æViveæ•°æ®                                          â”‚
â”‚     - è®¡ç®—åˆ°ç›®æ ‡ç‚¹çš„è·ç¦»å’Œè§’åº¦                              â”‚
â”‚     - åˆ¤æ–­æ˜¯å¦éœ€è¦è½¬å‘æˆ–å‰è¿›                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. æ§åˆ¶å‘½ä»¤ç”Ÿæˆé˜¶æ®µ                                        â”‚
â”‚     ç”Ÿæˆå‘½ä»¤: "F<speed>", "L<rate>", "R<rate>", "S"        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5. å‘½ä»¤æ‰§è¡Œé˜¶æ®µ (Servantæ¿)                                â”‚
â”‚     - æ¥æ”¶æ§åˆ¶å‘½ä»¤                                          â”‚
â”‚     - æ§åˆ¶ç”µæœºè¿åŠ¨                                          â”‚
â”‚     - è¿”å›æ–°çš„Viveä½ç½®                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
                    (å¾ªç¯ç›´åˆ°åˆ°è¾¾ç›®æ ‡)
```

---

## ğŸ“ é˜¶æ®µ1ï¼šViveä½ç½®è·å–ï¼ˆServantæ¿ï¼‰

### 1.1 ç¡¬ä»¶é…ç½®

**ä¸¤ä¸ªTrackerå®‰è£…ä½ç½®ï¼š**
- **Tracker 1** (GPIO 15)ï¼šè½¦åå·¦è¾¹
- **Tracker 2** (GPIO 16)ï¼šè½¦åå³è¾¹

### 1.2 ä½ç½®è®¡ç®—ä»£ç 

åœ¨ `gagac-2.ino` çš„ `loop()` å‡½æ•°ä¸­ï¼š

```cpp
if (isViveActive) {
    // å¤„ç†ä¸¤ä¸ªtrackerçš„æ•°æ®
    processViveData(viveFront, viveXFront, viveYFront);  // Tracker 1 (å·¦è¾¹)
    processViveData(viveBack, viveXBack, viveYBack);      // Tracker 2 (å³è¾¹)
    
    // è®¡ç®—ä¸­å¿ƒä½ç½®ï¼ˆä¸¤ä¸ªtrackerè¿çº¿çš„ä¸­ç‚¹ï¼‰
    viveX = (float(viveXFront) + float(viveXBack)) / 2.0;
    viveY = (float(viveYFront) + float(viveYBack)) / 2.0;
    
    // è®¡ç®—æœå‘è§’åº¦
    float deltaX = float(viveXBack) - float(viveXFront);
    float deltaY = float(viveYBack) - float(viveYFront);
    viveAngle = (180.0 / PI) * fastAtan2(deltaY, deltaX) + VIVE_ANGLE_OFFSET;
    
    // è§’åº¦å½’ä¸€åŒ–åˆ° -180Â° åˆ° 180Â°
    if (viveAngle > 180.0) {
        viveAngle -= 360.0;
    } else if (viveAngle < -180.0) {
        viveAngle += 360.0;
    }
}
```

### 1.3 æ•°æ®è¾“å‡º

**æ¯100msé€šè¿‡UARTå‘é€åˆ°Owneræ¿ï¼š**

```cpp
// åœ¨ gagac-2.ino ä¸­
if (millis() - lastViveUartTime > 100 && isViveActive) {
    lastViveUartTime = millis();
    // æ ¼å¼: "VIVE:x.xx,y.yy,a.aa\n"
    OwnerSerial.printf("VIVE:%.2f,%.2f,%.2f\n", viveX, viveY, viveAngle);
}
```

**æ•°æ®æ ¼å¼è¯´æ˜ï¼š**
- `x.xx`ï¼šXåæ ‡ï¼ˆå•ä½ï¼šViveåæ ‡å•ä½ï¼Œé€šå¸¸1000-8000ï¼‰
- `y.yy`ï¼šYåæ ‡ï¼ˆå•ä½ï¼šViveåæ ‡å•ä½ï¼Œé€šå¸¸1000-8000ï¼‰
- `a.aa`ï¼šæœå‘è§’åº¦ï¼ˆå•ä½ï¼šåº¦ï¼ŒèŒƒå›´-180Â°åˆ°180Â°ï¼‰

---

## ğŸ“¡ é˜¶æ®µ2ï¼šæ•°æ®ä¼ è¾“ï¼ˆUARTé€šä¿¡ï¼‰

### 2.1 é€šä¿¡é…ç½®

**ç¡¬ä»¶è¿æ¥ï¼š**
- Servantæ¿ï¼šTX=7, RX=6
- Owneræ¿ï¼šRX=6, TX=7
- æ³¢ç‰¹ç‡ï¼š115200

### 2.2 Owneræ¿æ¥æ”¶ä»£ç 

åœ¨ `owner-4.ino` ä¸­æ¥æ”¶Viveæ•°æ®ï¼š

```cpp
// å…¨å±€å˜é‡å­˜å‚¨Viveæ•°æ®
float viveX = 0.0, viveY = 0.0, viveAngle = 0.0;
bool hasViveData = false;

void loop() {
    // ä»Servantæ¿æ¥æ”¶æ•°æ®
    if (ServantSerial.available()) {
        String data = ServantSerial.readStringUntil('\n');
        data.trim();
        
        // è§£æViveæ•°æ®
        if (data.startsWith("VIVE:")) {
            // æ ¼å¼: "VIVE:x.xx,y.yy,a.aa"
            int comma1 = data.indexOf(',');
            int comma2 = data.indexOf(',', comma1 + 1);
            
            if (comma1 > 0 && comma2 > 0) {
                viveX = data.substring(5, comma1).toFloat();
                viveY = data.substring(comma1 + 1, comma2).toFloat();
                viveAngle = data.substring(comma2 + 1).toFloat();
                hasViveData = true;
            }
        }
    }
}
```

---

## ğŸ§® é˜¶æ®µ3ï¼šå¯¼èˆªè®¡ç®—ï¼ˆOwneræ¿ï¼‰

### 3.1 å¯¼èˆªç®—æ³•æ ¸å¿ƒå‡½æ•°

åœ¨ `behavior-vive.ino` ä¸­çš„ `gotoPoint()` å‡½æ•°ï¼š

```cpp
bool gotoPoint(float xDesired, float yDesired, 
               float viveX, float viveY, float viveAngle, 
               String& cmd) {
    // æ­¥éª¤1ï¼šè®¡ç®—åˆ°ç›®æ ‡ç‚¹çš„è·ç¦»å’Œæ–¹å‘
    float deltaY = yDesired - viveY;
    float deltaX = xDesired - viveX;
    float distance = sqrt(deltaX * deltaX + deltaY * deltaY);
    
    // æ­¥éª¤2ï¼šè®¡ç®—ç›®æ ‡æ–¹å‘è§’åº¦
    float desiredAngle = (180.0 / PI) * fastAtan2(deltaY, deltaX) + 90.0;
    
    // è§’åº¦å½’ä¸€åŒ–
    if (desiredAngle > 180.0) desiredAngle -= 360.0;
    if (desiredAngle < -180.0) desiredAngle += 360.0;
    
    // æ­¥éª¤3ï¼šè®¡ç®—å½“å‰æœå‘ä¸ç›®æ ‡æ–¹å‘çš„å¤¹è§’è¯¯å·®
    float currentAngle = viveAngle;
    if (currentAngle > 180.0) currentAngle -= 360.0;
    if (currentAngle < -180.0) currentAngle += 360.0;
    
    float angleError = desiredAngle - currentAngle;
    if (angleError > 180.0) angleError -= 360.0;
    if (angleError < -180.0) angleError += 360.0;
    
    // æ­¥éª¤4ï¼šåˆ¤æ–­æ˜¯å¦åˆ°è¾¾ç›®æ ‡
    if (distance <= DISTANCE_TOLERANCE) {  // é»˜è®¤5mm
        cmd = "S";  // åœæ­¢
        return true;
    }
    
    // æ­¥éª¤5ï¼šå†³ç­–ï¼šå…ˆè½¬å‘è¿˜æ˜¯ç›´æ¥å‰è¿›
    if (abs(angleError) > ANGLE_TOLERANCE) {  // é»˜è®¤20Â°
        // éœ€è¦å…ˆè½¬å‘
        if (angleError > 0) {
            cmd = "R" + String(60);  // å³è½¬ï¼ˆé¡ºæ—¶é’ˆï¼‰
        } else {
            cmd = "L" + String(60);  // å·¦è½¬ï¼ˆé€†æ—¶é’ˆï¼‰
        }
        return false;
    }
    
    // æ­¥éª¤6ï¼šæœå‘æ­£ç¡®ï¼Œå‰è¿›
    float speed = 50.0f;  // åŸºç¡€é€Ÿåº¦
    if (distance < 50.0f) {
        speed = 30.0f;  // æ¥è¿‘æ—¶å‡é€Ÿ
    } else if (distance < 100.0f) {
        speed = 40.0f;
    }
    cmd = "F" + String((int)speed);
    return false;
}
```

### 3.2 å¯¼èˆªå‚æ•°

**å¯è°ƒæ•´å‚æ•°ï¼ˆåœ¨ `behavior-vive.ino` ä¸­ï¼‰ï¼š**

```cpp
const float ANGLE_TOLERANCE = 20.0f;      // è§’åº¦è¯¯å·®é˜ˆå€¼ï¼ˆåº¦ï¼‰
const float DISTANCE_TOLERANCE = 5.0f;     // åˆ°è¾¾è·ç¦»é˜ˆå€¼ï¼ˆmmï¼‰
```

**é€Ÿåº¦å‚æ•°ï¼š**
- åŸºç¡€é€Ÿåº¦ï¼š50%
- è·ç¦» < 100mmï¼š40%
- è·ç¦» < 50mmï¼š30%

---

## ğŸ® é˜¶æ®µ4ï¼šæ§åˆ¶å‘½ä»¤ç”Ÿæˆ

### 4.1 å‘½ä»¤æ ¼å¼

**æ§åˆ¶å‘½ä»¤æ ¼å¼ï¼ˆOwneræ¿ â†’ Servantæ¿ï¼‰ï¼š**

| å‘½ä»¤ | æ ¼å¼ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|------|
| å‰è¿› | `F<speed>` | speed: 0-100ï¼ˆé€Ÿåº¦ç™¾åˆ†æ¯”ï¼‰ | `F50` = 50%é€Ÿåº¦å‰è¿› |
| åé€€ | `B<speed>` | speed: 0-100 | `B30` = 30%é€Ÿåº¦åé€€ |
| å·¦è½¬ | `L<rate>` | rate: 0-100ï¼ˆè½¬å‘å¼ºåº¦ï¼‰ | `L60` = 60%å¼ºåº¦å·¦è½¬ |
| å³è½¬ | `R<rate>` | rate: 0-100 | `R60` = 60%å¼ºåº¦å³è½¬ |
| åœæ­¢ | `S` | ç«‹å³åœæ­¢ | `S` |

### 4.2 å‘½ä»¤å‘é€

åœ¨ `owner-4.ino` ä¸­ï¼š

```cpp
void sendToServant(const String &cmd) {
    ServantSerial.println(cmd);  // é€šè¿‡UARTå‘é€
    Serial.println(cmd);         // ä¸²å£è¾“å‡ºï¼ˆè°ƒè¯•ç”¨ï¼‰
}

// ä½¿ç”¨ç¤ºä¾‹
String cmd;
bool reached = gotoPoint(targetX, targetY, viveX, viveY, viveAngle, cmd);
sendToServant(cmd);
```

---

## âš™ï¸ é˜¶æ®µ5ï¼šå‘½ä»¤æ‰§è¡Œï¼ˆServantæ¿ï¼‰

### 5.1 å‘½ä»¤æ¥æ”¶

åœ¨ `gagac-2.ino` çš„ `loop()` ä¸­ï¼š

```cpp
// ä»Owneræ¿æ¥æ”¶å‘½ä»¤
if (OwnerSerial.available()) {
    String cmd = OwnerSerial.readStringUntil('\n');
    cmd.trim();
    handleCommand(cmd);
}
```

### 5.2 å‘½ä»¤å¤„ç†

åœ¨ `gagac-2.ino` çš„ `handleCommand()` å‡½æ•°ä¸­ï¼š

```cpp
void handleCommand(String cmd) {
    cmd.trim();
    cmd.toUpperCase();
    
    if (cmd.startsWith("F")) {
        // å‰è¿›ï¼šF<speed>
        float speed = cmd.substring(1).toFloat();
        setCarSpeed(speed);
    }
    else if (cmd.startsWith("B")) {
        // åé€€ï¼šB<speed>
        float speed = cmd.substring(1).toFloat();
        setCarSpeed(-speed);
    }
    else if (cmd.startsWith("L")) {
        // å·¦è½¬ï¼šL<rate>
        float turnRate = cmd.substring(1).toFloat();
        setCarTurn(50, -turnRate);  // è´Ÿå·è¡¨ç¤ºå·¦è½¬
    }
    else if (cmd.startsWith("R")) {
        // å³è½¬ï¼šR<rate>
        float turnRate = cmd.substring(1).toFloat();
        setCarTurn(50, turnRate);   // æ­£å·è¡¨ç¤ºå³è½¬
    }
    else if (cmd == "S") {
        // åœæ­¢
        stopMotors();
    }
}
```

### 5.3 ç”µæœºæ§åˆ¶

```cpp
void setCarSpeed(float speedPercent) {
    float maxRPM = MOTOR_MAX_RPM_RATED * 0.9;
    float targetRPM = maxRPM * speedPercent / 100.0;
    
    targetSpeedL = 0.996 * targetRPM;  // å·¦è½®ç¨å¾®æ…¢ä¸€ç‚¹ï¼ˆæ ¡å‡†ï¼‰
    targetSpeedR = targetRPM;
}

void setCarTurn(float speedPercent, float turnRate) {
    float maxRPM = MOTOR_MAX_RPM_RATED * 0.9;
    float baseSpeed = maxRPM * speedPercent / 100.0;
    
    float turnFactor = turnRate / 100.0;
    targetSpeedL = baseSpeed * (1.0 + turnFactor);  // å·¦è½®åŠ é€Ÿ
    targetSpeedR = baseSpeed * (1.0 - turnFactor);  // å³è½®å‡é€Ÿ
}
```

---

## ğŸ” å®Œæ•´å¯¼èˆªå¾ªç¯

### å¯¼èˆªå¾ªç¯ç¤ºä¾‹ï¼ˆOwneræ¿ï¼‰

```cpp
void loop() {
    // 1. æ¥æ”¶Viveæ•°æ®
    if (ServantSerial.available()) {
        String data = ServantSerial.readStringUntil('\n');
        if (data.startsWith("VIVE:")) {
            // è§£æViveæ•°æ®
            parseViveData(data, viveX, viveY, viveAngle);
            hasViveData = true;
        }
    }
    
    // 2. å¦‚æœå¤„äºå¯¼èˆªæ¨¡å¼ä¸”æœ‰Viveæ•°æ®
    if (isNavigating && hasViveData) {
        String cmd;
        
        // 3. è®¡ç®—å¯¼èˆªå‘½ä»¤
        bool reached = gotoPoint(targetX, targetY, 
                                viveX, viveY, viveAngle, 
                                cmd);
        
        // 4. å‘é€æ§åˆ¶å‘½ä»¤
        sendToServant(cmd);
        
        // 5. å¦‚æœåˆ°è¾¾ç›®æ ‡ï¼Œåœæ­¢å¯¼èˆª
        if (reached) {
            isNavigating = false;
            Serial.println("Target reached!");
        }
    }
    
    delay(50);  // æ§åˆ¶å¾ªç¯é¢‘ç‡ï¼ˆ20Hzï¼‰
}
```

---

## ğŸ“Š å¯¼èˆªçŠ¶æ€æœº

### çŠ¶æ€è½¬æ¢å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   IDLE      â”‚  (ç­‰å¾…çŠ¶æ€)
â”‚  (åœæ­¢)     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ æ”¶åˆ°å¯¼èˆªå‘½ä»¤
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  TURNING    â”‚  (è½¬å‘çŠ¶æ€)
â”‚  (è°ƒæ•´è§’åº¦) â”‚  â”€â”€â†’ è§’åº¦è¯¯å·® > 20Â°
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ è§’åº¦è¯¯å·® < 20Â°
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MOVING     â”‚  (å‰è¿›çŠ¶æ€)
â”‚  (å‘ç›®æ ‡)   â”‚  â”€â”€â†’ è·ç¦» > 5mm
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ è·ç¦» < 5mm
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  REACHED    â”‚  (åˆ°è¾¾çŠ¶æ€)
â”‚  (åœæ­¢)     â”‚  â”€â”€â†’ è¿”å›IDLE
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### çŠ¶æ€åˆ¤æ–­é€»è¾‘

```cpp
// ä¼ªä»£ç 
if (distance <= DISTANCE_TOLERANCE) {
    // çŠ¶æ€ï¼šREACHED
    cmd = "S";
    return true;
}
else if (abs(angleError) > ANGLE_TOLERANCE) {
    // çŠ¶æ€ï¼šTURNING
    if (angleError > 0) cmd = "R60";
    else cmd = "L60";
    return false;
}
else {
    // çŠ¶æ€ï¼šMOVING
    cmd = "F" + String(speed);
    return false;
}
```

---

## ğŸ¯ å®é™…ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹1ï¼šå¯¼èˆªåˆ°å•ä¸ªç›®æ ‡ç‚¹

```cpp
// åœ¨ owner-4.ino ä¸­

// 1. å®šä¹‰ç›®æ ‡ç‚¹
const float TARGET_X = 3000.0;
const float TARGET_Y = 4000.0;

// 2. å¯åŠ¨å¯¼èˆª
void startNavigation() {
    isNavigating = true;
    targetX = TARGET_X;
    targetY = TARGET_Y;
}

// 3. åœ¨loop()ä¸­æ‰§è¡Œå¯¼èˆª
void loop() {
    // æ¥æ”¶Viveæ•°æ®...
    
    if (isNavigating && hasViveData) {
        String cmd;
        bool reached = gotoPoint(targetX, targetY, 
                                viveX, viveY, viveAngle, 
                                cmd);
        sendToServant(cmd);
        
        if (reached) {
            isNavigating = false;
            Serial.println("Target reached!");
        }
    }
}
```

### ç¤ºä¾‹2ï¼šåºåˆ—å¯¼èˆªï¼ˆ3ä¸ªä½ç½®ï¼‰

```cpp
// å®šä¹‰3ä¸ªç›®æ ‡ç‚¹
const float TARGETS[3][2] = {
    {2000.0, 2000.0},  // ä½ç½®1
    {6000.0, 2000.0},  // ä½ç½®2
    {4000.0, 4000.0}   // ä½ç½®3
};

int currentTarget = 0;
bool isNavigating = false;

void loop() {
    // æ¥æ”¶Viveæ•°æ®...
    
    if (isNavigating && hasViveData) {
        String cmd;
        bool reached = gotoPoint(
            TARGETS[currentTarget][0], 
            TARGETS[currentTarget][1],
            viveX, viveY, viveAngle, 
            cmd
        );
        sendToServant(cmd);
        
        if (reached) {
            currentTarget++;
            if (currentTarget >= 3) {
                // å®Œæˆæ‰€æœ‰ç›®æ ‡
                isNavigating = false;
                Serial.println("All targets reached!");
            } else {
                Serial.printf("Target %d reached, moving to target %d\n", 
                             currentTarget, currentTarget + 1);
            }
        }
    }
}
```

---

## âš™ï¸ å‚æ•°è°ƒä¼˜æŒ‡å—

### å¯¼èˆªç²¾åº¦è°ƒæ•´

**å¦‚æœæœºå™¨äººæ— æ³•ç²¾ç¡®åˆ°è¾¾ç›®æ ‡ï¼š**

```cpp
// å‡å°è·ç¦»é˜ˆå€¼ï¼ˆæ›´ç²¾ç¡®ï¼Œä½†å¯èƒ½æ— æ³•åˆ°è¾¾ï¼‰
const float DISTANCE_TOLERANCE = 3.0f;  // ä»5.0æ”¹ä¸º3.0

// æˆ–å¢å¤§è·ç¦»é˜ˆå€¼ï¼ˆæ›´å®¹æ˜“åˆ°è¾¾ï¼Œä½†ç²¾åº¦é™ä½ï¼‰
const float DISTANCE_TOLERANCE = 10.0f;  // ä»5.0æ”¹ä¸º10.0
```

### è½¬å‘çµæ•åº¦è°ƒæ•´

**å¦‚æœè½¬å‘ä¸å¤Ÿçµæ•æˆ–è¿‡äºæ•æ„Ÿï¼š**

```cpp
// å‡å°è§’åº¦é˜ˆå€¼ï¼ˆæ›´é¢‘ç¹è½¬å‘ï¼Œæ›´ç²¾ç¡®ï¼‰
const float ANGLE_TOLERANCE = 10.0f;  // ä»20.0æ”¹ä¸º10.0

// å¢å¤§è§’åº¦é˜ˆå€¼ï¼ˆå‡å°‘è½¬å‘ï¼Œæ›´å¹³æ»‘ï¼‰
const float ANGLE_TOLERANCE = 30.0f;  // ä»20.0æ”¹ä¸º30.0
```

### é€Ÿåº¦è°ƒæ•´

**å¦‚æœé€Ÿåº¦å¤ªå¿«æˆ–å¤ªæ…¢ï¼š**

```cpp
// åœ¨ gotoPoint() å‡½æ•°ä¸­
float speed = 50.0f;  // åŸºç¡€é€Ÿåº¦ï¼ˆ0-100ï¼‰
if (distance < 50.0f) {
    speed = 30.0f;  // æ¥è¿‘æ—¶é€Ÿåº¦
} else if (distance < 100.0f) {
    speed = 40.0f;  // ä¸­ç­‰è·ç¦»é€Ÿåº¦
}
```

### è½¬å‘å¼ºåº¦è°ƒæ•´

**å¦‚æœè½¬å‘ä¸å¤Ÿæˆ–è¿‡åº¦ï¼š**

```cpp
// åœ¨ gotoPoint() å‡½æ•°ä¸­
if (angleError > 0) {
    cmd = "R" + String(60);  // å³è½¬å¼ºåº¦ï¼ˆ0-100ï¼‰
} else {
    cmd = "L" + String(60);  // å·¦è½¬å¼ºåº¦ï¼ˆ0-100ï¼‰
}
```

---

## ğŸ› å¸¸è§é—®é¢˜ä¸è§£å†³

### é—®é¢˜1ï¼šæœºå™¨äººæ— æ³•åˆ°è¾¾ç›®æ ‡

**å¯èƒ½åŸå› ï¼š**
- è·ç¦»é˜ˆå€¼å¤ªå°
- é€Ÿåº¦å¤ªæ…¢
- è§’åº¦é˜ˆå€¼å¤ªå¤§

**è§£å†³æ–¹æ³•ï¼š**
```cpp
// å¢å¤§è·ç¦»é˜ˆå€¼
const float DISTANCE_TOLERANCE = 10.0f;

// æé«˜é€Ÿåº¦
float speed = 60.0f;  // ä»50.0æé«˜

// å‡å°è§’åº¦é˜ˆå€¼
const float ANGLE_TOLERANCE = 15.0f;
```

### é—®é¢˜2ï¼šæœºå™¨äººæ¥å›æ‘†åŠ¨

**å¯èƒ½åŸå› ï¼š**
- è§’åº¦é˜ˆå€¼å¤ªå°
- æ§åˆ¶é¢‘ç‡å¤ªé«˜

**è§£å†³æ–¹æ³•ï¼š**
```cpp
// å¢å¤§è§’åº¦é˜ˆå€¼
const float ANGLE_TOLERANCE = 25.0f;

// é™ä½æ§åˆ¶é¢‘ç‡
delay(100);  // ä»50msæ”¹ä¸º100ms
```

### é—®é¢˜3ï¼šæœºå™¨äººè½¬å‘è¿‡åº¦

**å¯èƒ½åŸå› ï¼š**
- è½¬å‘å¼ºåº¦å¤ªå¤§
- è§’åº¦è¯¯å·®è®¡ç®—æœ‰è¯¯

**è§£å†³æ–¹æ³•ï¼š**
```cpp
// å‡å°è½¬å‘å¼ºåº¦
cmd = "R" + String(40);  // ä»60æ”¹ä¸º40
cmd = "L" + String(40);
```

---

## ğŸ“ æ€»ç»“

### å…³é”®æ­¥éª¤å›é¡¾

1. **ä½ç½®è·å–**ï¼šä¸¤ä¸ªtracker â†’ ä¸­å¿ƒä½ç½® + æœå‘è§’åº¦
2. **æ•°æ®ä¼ è¾“**ï¼šServantæ¿ â†’ Owneræ¿ï¼ˆUARTï¼Œ100msä¸€æ¬¡ï¼‰
3. **å¯¼èˆªè®¡ç®—**ï¼šè®¡ç®—è·ç¦»å’Œè§’åº¦è¯¯å·® â†’ ç”Ÿæˆæ§åˆ¶å‘½ä»¤
4. **å‘½ä»¤æ‰§è¡Œ**ï¼šOwneræ¿ â†’ Servantæ¿ â†’ ç”µæœºæ§åˆ¶
5. **å¾ªç¯æ‰§è¡Œ**ï¼šç›´åˆ°åˆ°è¾¾ç›®æ ‡

### å…³é”®å‚æ•°

- **DISTANCE_TOLERANCE**ï¼šåˆ°è¾¾åˆ¤æ–­è·ç¦»ï¼ˆé»˜è®¤5mmï¼‰
- **ANGLE_TOLERANCE**ï¼šè½¬å‘åˆ¤æ–­è§’åº¦ï¼ˆé»˜è®¤20Â°ï¼‰
- **é€Ÿåº¦**ï¼šåŸºç¡€50%ï¼Œæ¥è¿‘æ—¶30-40%
- **è½¬å‘å¼ºåº¦**ï¼š60%

### è°ƒè¯•å»ºè®®

1. ä½¿ç”¨ä¸²å£ç›‘è§†å™¨æŸ¥çœ‹Viveæ•°æ®å’Œå¯¼èˆªçŠ¶æ€
2. é€æ­¥è°ƒæ•´å‚æ•°ï¼Œè§‚å¯Ÿæ•ˆæœ
3. è®°å½•åˆ°è¾¾æ—¶é—´å’Œç²¾åº¦ï¼Œä¼˜åŒ–å‚æ•°
4. æµ‹è¯•ä¸åŒè·ç¦»å’Œè§’åº¦çš„ç›®æ ‡ç‚¹

---

**æç¤º**ï¼šæ ¹æ®å®é™…æµ‹è¯•ç»“æœè°ƒæ•´å‚æ•°ï¼Œæ¯ä¸ªæœºå™¨äººçš„ç‰¹æ€§å¯èƒ½ä¸åŒã€‚

