# 网页界面更新说明

## 更新时间
2025年12月12日

## 主要修改内容

### 1. 移除旧的Route功能
- ✅ 删除了"Start Manual Plan"按钮
- ✅ 删除了"Send Route"按钮  
- ✅ 删除了手动输入路径的textarea（x,y,heading,bumps格式）
- ✅ 在`gagac-2.ino`中移除了`MP_ON`、`MP_OFF`、`MP_ROUTE:`命令处理

### 2. 优化智能路径规划功能
采用新的"Plan to Target"方法，特点：
- 🎯 **目标点设置**：只需输入目标坐标(x,y)
- 📍 **起点控制**：可锁定当前位置或使用VIVE实时位置
- 🚧 **障碍物配置**：支持自定义障碍物、加载默认、禁用
- 📏 **场地边界**：可自定义场地边界范围
- 🤖 **自动避障**：系统自动规划曼哈顿路径并绕开障碍物

### 3. 新增配置清单(Checklist)
实时显示系统配置状态，包括：
- ⚪/✅ **VIVE定位系统**：根据tracker状态自动更新
- ⚪/✅ **场地边界**：默认已设置
- ⚪/✅ **障碍物配置**：是否配置了障碍物
- ⚪/✅ **目标点设置**：是否输入了目标坐标
- ⚪/✅ **路径规划完成**：是否成功规划路径

### 4. 增强路径预览功能
**新的大图可视化界面**，包含：

#### 视觉元素
- 🟢 **绿色边框**：场地边界
- 🟥 **红色半透明区域**：障碍物+安全边距
- 🔵 **蓝色路径线**：规划的行驶路径
- 🟠 **橙色点**：当前实时位置（动态更新）
- ⚫ **灰色点**：起点位置
- 🔵 **蓝色点**：目标点位置
- 📐 **灰色网格**：辅助定位的背景网格

#### 交互功能
- 💡 **点击Canvas选择目标**：直接点击地图设置目标点
- 🔄 **实时更新**：每2秒自动刷新当前位置
- 👀 **预览模式**：输入参数即时显示效果

#### Canvas尺寸
- 从 320×260 增大到 **480×400**
- 更大的显示区域，看清所有细节

### 5. 改进的用户体验

#### 视觉优化
- 🎨 使用浅蓝色背景框突出规划区域
- 📋 清晰的区域分组和标题
- 🌈 丰富的颜色图例说明
- ✨ 更大更清晰的Canvas显示

#### 智能提示
- 输入格式错误时弹出友好提示
- VIVE未启用时提醒用户
- 实时显示状态信息（规划中/已完成/已停止等）

#### 自动化功能
- VIVE状态自动检测并更新checklist
- 输入目标点自动预览位置
- 路径规划后自动更新状态

### 6. 命令更新

#### 新增命令（转发给Owner）
```
PLAN1:x,y           - 开始规划并执行到目标点
PLAN_STOP           - 停止路径执行
PLAN_OBS:l,r,t,b,m  - 设置障碍物
PLAN_OBS_OFF        - 禁用障碍物
PLAN_BOUND:xmin,xmax,ymax,ymin - 设置边界
PLAN_SET_START:x,y  - 锁定起点
PLAN_CLEAR_START    - 使用实时起点
```

#### 移除的命令
```
MP_ON               - (已删除)
MP_OFF              - (已删除)
MP_ROUTE:...        - (已删除)
```

## 使用流程

### 推荐操作步骤：

1. **启用VIVE** 📡
   - 点击"Enable VIVE"按钮
   - 等待checklist显示✅

2. **设置障碍物** 🚧（可选）
   - 点击"加载默认"使用预设障碍物
   - 或在输入框中自定义：left,right,top,bottom,margin
   - 点击"自定义"应用

3. **设置目标点** 🎯
   - 在"目标点"输入框输入坐标，如：`4500,3200`
   - 或直接点击Canvas上的位置
   - 预览画面会显示目标点

4. **（可选）锁定起点** 📍
   - 如需固定起点，点击"锁定当前位置"
   - 默认使用VIVE实时位置

5. **开始执行** ▶️
   - 点击"▶️ 开始规划并执行"
   - 系统自动规划路径并开始移动
   - Canvas上实时显示当前位置

6. **监控执行** 👀
   - 观察Canvas上的橙色点（当前位置）沿蓝色路径移动
   - 需要时点击"⏹️ 停止"

## 技术细节

### 文件修改
- `gagac-web.h`：网页HTML/CSS/JavaScript
- `gagac-2.ino`：命令处理逻辑

### 状态管理
使用JavaScript对象`configState`追踪所有配置状态：
```javascript
{
  viveActive: boolean,   // VIVE是否正常工作
  boundSet: boolean,     // 边界是否设置
  obsSet: boolean,       // 障碍物是否设置
  targetSet: boolean,    // 目标点是否设置
  pathPlanned: boolean   // 路径是否已规划
}
```

### 自动更新机制
- VIVE数据：每1秒更新一次
- 路径可视化：每2秒刷新一次（当路径已规划时）
- Checklist：配置变更时立即更新

## 测试建议

1. ✅ 测试VIVE状态自动检测
2. ✅ 测试点击Canvas设置目标点
3. ✅ 测试输入不同格式的参数
4. ✅ 测试路径规划（有/无障碍物）
5. ✅ 测试实时位置显示
6. ✅ 测试锁定/解锁起点功能

## 已知改进
- 移除了复杂的路径点输入方式
- 简化为目标点+自动规划
- 增强了可视化反馈
- 添加了配置状态追踪
- 提供了交互式地图选点

## 未来可扩展功能
- 🚀 支持多个目标点序列
- 🎮 添加路径编辑功能（拖拽调整）
- 📊 显示历史轨迹
- 🔧 实时调整规划参数
- 💾 保存/加载配置方案

---
**注意**：所有修改已完成并通过语法检查，可直接编译上传。

