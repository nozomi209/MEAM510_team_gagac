## 网页控制与“Plan to Target”规划使用说明

网页代码在 `510finalgagac/gagac-2/gagac-web.h`，运行在 Servant 板的 WebServer 上（默认 `http://192.168.4.1`）。网页做两件事：

- **手动控制**：直接让 Servant 执行 `F/B/L/R/S` 运动指令
- **规划/自动**：把 `AUTO_*`、`PLAN_*` 等指令转发给 Owner，由 Owner 生成 `F/L/R/S` 再回传给 Servant 执行

---

### 1) 连接与打开网页

- 连接 WiFi：`ESP32-MobileBase`（密码：`12345678`）
- 浏览器打开：`http://192.168.4.1`

---

### 2) 手动控制（网页 → Servant 直接执行）

网页通过 `/cmd?data=...` 发送指令给 Servant：

- `F<speed>`：前进（0~100）
- `B<speed>`：后退（0~100）
- `L<rate>`：左转（0~100）
- `R<rate>`：右转（0~100）
- `S`：停车

对应代码路径：

- `gagac-web.h`（按钮/JS 拼出 `data`）
- `gagac-2.ino` 的 `server.on("/cmd", ...)` 接收并执行

---

### 3) Auto 开关（网页 → Servant 转发 → Owner）

- `AUTO_ON`：Owner 开始输出自动行为指令
- `AUTO_OFF`：Owner 停止自动并下发 `S`

对应代码路径：

- Servant：`gagac-2.ino` 收到 `AUTO_ON/OFF` 后 `OwnerSerial.println(...)`
- Owner：`owner-4.ino` 解析 `AUTO_ON/OFF` 并控制 `isAutoRunning`

---

### 4) Plan to Target：规划并执行（网页 → Servant 转发 → Owner）

Owner 侧在 `owner-4.ino` 内处理以下命令，并调用 `manual_planner` 生成可执行路径（最终仍输出 `F/L/R/S`）：

#### 4.1 目标点规划并执行

- `PLAN1:x,y`  
  - **含义**：从当前 Vive 起点规划到 `(x,y)` 并开始执行  
  - **Owner 行为**：`mp_planTargets(viveX, viveY, targets, 1, MP_PATH_MARGIN)`，成功后进入 `isPathPlanMode=true`

#### 4.2 停止执行

- `PLAN_STOP`  
  - **含义**：停止规划执行并停车  

#### 4.3 设置/关闭障碍物

- `PLAN_OBS:left,right,top,bottom[,margin]`  
  - **含义**：设置障碍框（可选第 5 个参数 `margin` 作为安全边距）  
  - **Owner 行为**：`mp_setObstacleBox(...)`、`mp_setObstacleEnabled(true)`，并可 `mp_setPathMargin(margin)`

- `PLAN_OBS_OFF`  
  - **含义**：禁用障碍物  

#### 4.4 设置边界

- `PLAN_BOUND:xmin,xmax,ymax,ymin`  
  - **含义**：设置规划外边界（单位 mm）  
  - **Owner 行为**：`mp_setBoundary(...)`、`mp_setBoundaryEnabled(true)`

#### 4.5 锁定/取消锁定起点

- `PLAN_SET_START` 或 `PLAN_SET_START:x,y`  
  - **含义**：锁定规划起点（不写参数则用当前 Vive）  

- `PLAN_CLEAR_START`  
  - **含义**：取消锁定（回到实时 Vive 起点）

---

### 5) 网页到代码的“数据通路”

1. 网页 JS 把命令拼成 `data`
2. Servant 在 `/cmd` 接口收到后：
   - **运动类**：直接执行
   - **AUTO/PLAN 类**：`OwnerSerial.println(...)` 转发
3. Owner 收到后：
   - 更新状态机（`isAutoRunning/isPathPlanMode/...`）
   - 周期性输出 `F/L/R/S` 给 Servant


